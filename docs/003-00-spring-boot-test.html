<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-07-28T09:05:04.298813"><title>Chapitre 3 : L'Int&eacute;gration Transparente : Tester avec Spring Boot (L'essentiel) | Java Spring Test</title><script type="application/json" id="virtual-toc-data">[{"id":"objectifs-p-dagogiques","level":0,"title":"Objectifs pédagogiques","anchor":"#objectifs-p-dagogiques"},{"id":"introduction-votre-quipe-de-ravitaillement-personnelle","level":0,"title":"Introduction : Votre équipe de ravitaillement personnelle","anchor":"#introduction-votre-quipe-de-ravitaillement-personnelle"},{"id":"le-starter-magique-spring-boot-starter-test","level":0,"title":"Le Starter Magique : spring-boot-starter-test","anchor":"#le-starter-magique-spring-boot-starter-test"},{"id":"springboottest-le-test-grandeur-nature","level":0,"title":"@SpringBootTest : Le Test Grandeur Nature","anchor":"#springboottest-le-test-grandeur-nature"},{"id":"l-injection-de-d-pendances-au-service-des-tests","level":0,"title":"L\u0027Injection de Dépendances au Service des Tests","anchor":"#l-injection-de-d-pendances-au-service-des-tests"},{"id":"configurer-votre-environnement-de-test","level":0,"title":"Configurer Votre Environnement de Test","anchor":"#configurer-votre-environnement-de-test"},{"id":"exercice-5-votre-premier-test-d-int-gration-avec-spring-boot","level":0,"title":"Exercice 5 : Votre premier test d\u0027intégration avec Spring Boot","anchor":"#exercice-5-votre-premier-test-d-int-gration-avec-spring-boot"},{"id":"correction-exercice-5","level":0,"title":"Correction exercice 5","anchor":"#correction-exercice-5"},{"id":"auto-valuation","level":0,"title":"Auto-évaluation","anchor":"#auto-valuation"},{"id":"conclusion-de-la-partie","level":0,"title":"Conclusion de la partie","anchor":"#conclusion-de-la-partie"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Chapitre 3 : L'Int&eacute;gration Transparente : Tester avec Spring Boot (L'essentiel) | Java Spring Test"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Java Spring Test Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/003-00-spring-boot-test.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Chapitre 3 : L'Int&eacute;gration Transparente : Tester avec Spring Boot (L'essentiel) | Java Spring Test"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/003-00-spring-boot-test.html#webpage",
    "url": "writerside-documentation/003-00-spring-boot-test.html",
    "name": "Chapitre 3 : L'Int&eacute;gration Transparente : Tester avec Spring Boot (L'essentiel) | Java Spring Test",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Java Spring Test Help"
}</script><!-- End Schema.org --></head><body data-id="003-00-spring-boot-test" data-main-title="Chapitre 3 : L'Intégration Transparente : Tester avec Spring Boot (L'essentiel)" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs=""><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Java Spring Test  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="003-00-spring-boot-test" id="003-00-spring-boot-test.md">Chapitre 3 : L'Intégration Transparente : Tester avec Spring Boot (L'essentiel)</h1><section class="chapter"><h2 id="objectifs-p-dagogiques" data-toc="objectifs-p-dagogiques">Objectifs p&eacute;dagogiques</h2><p id="-7m2aej_13">&Agrave; la fin de cette partie, vous serez en mesure de :</p><ul class="list _bullet" id="-7m2aej_14"><li class="list__item" id="-7m2aej_15"><p id="-7m2aej_20"><span class="control" id="-7m2aej_21">Expliquer</span> le r&ocirc;le du starter <code class="code" id="-7m2aej_22">spring-boot-starter-test</code> et les d&eacute;pendances qu'il apporte.</p></li><li class="list__item" id="-7m2aej_16"><p id="-7m2aej_23"><span class="control" id="-7m2aej_24">Utiliser</span> l'annotation <code class="code" id="-7m2aej_25">@SpringBootTest</code> pour charger un contexte d'application pour vos tests.</p></li><li class="list__item" id="-7m2aej_17"><p id="-7m2aej_26"><span class="control" id="-7m2aej_27">Injecter</span> des beans de votre application dans vos classes de test avec <code class="code" id="-7m2aej_28">@Autowired</code>.</p></li><li class="list__item" id="-7m2aej_18"><p id="-7m2aej_29"><span class="control" id="-7m2aej_30">Isoler</span> vos tests en rempla&ccedil;ant des beans de l'application par des mocks gr&acirc;ce &agrave; <code class="code" id="-7m2aej_31">@MockBean</code>.</p></li><li class="list__item" id="-7m2aej_19"><p id="-7m2aej_32"><span class="control" id="-7m2aej_33">Configurer</span> un environnement de test sp&eacute;cifique via des fichiers de propri&eacute;t&eacute;s et des profils.</p></li></ul></section><section class="chapter"><h2 id="introduction-votre-quipe-de-ravitaillement-personnelle" data-toc="introduction-votre-quipe-de-ravitaillement-personnelle">Introduction : Votre &eacute;quipe de ravitaillement personnelle</h2><p id="-7m2aej_34">Imaginez que vous &ecirc;tes un pilote de course. Dans le chapitre pr&eacute;c&eacute;dent, vous avez appris &agrave; piloter votre bolide (le code &agrave; tester) sur un circuit d'entra&icirc;nement vide (JUnit et Mockito en isolation). Vous contr&ocirc;lez tout manuellement. C'est parfait pour perfectionner votre technique sur une portion du circuit.</p><p id="-7m2aej_35">Mais maintenant, c'est le jour de la course. Vous devez tester votre voiture dans des conditions r&eacute;elles, avec le moteur qui tourne, l'&eacute;lectronique activ&eacute;e, et les pneus mont&eacute;s. Le feriez-vous tout seul ? Non ! Vous avez une &eacute;quipe de stand, une &quot;pit crew&quot;, qui pr&eacute;pare la voiture pour vous.</p><p id="-7m2aej_36"><span class="control" id="-7m2aej_39">Spring Test est votre &eacute;quipe de stand.</span></p><p id="-7m2aej_37">Au lieu de devoir assembler manuellement toutes les pi&egrave;ces de votre application (<code class="code" id="-7m2aej_40">new Service(new Repository(...))</code>), Spring Boot vous offre un cadre de test qui peut d&eacute;marrer votre application, injecter les bonnes d&eacute;pendances, et m&ecirc;me remplacer certaines pi&egrave;ces par des versions factices (<code class="code" id="-7m2aej_41">@MockBean</code>) sur demande.</p><p id="-7m2aej_38">Dans ce chapitre, nous allons d&eacute;couvrir comment laisser Spring Boot faire le gros du travail, pour que vous puissiez vous concentrer sur ce qui compte : &eacute;crire des tests qui valident le comportement r&eacute;el de votre application.</p></section><section class="chapter"><h2 id="le-starter-magique-spring-boot-starter-test" data-toc="le-starter-magique-spring-boot-starter-test">Le Starter Magique : <code class="code" id="-7m2aej_48">spring-boot-starter-test</code></h2><p id="-7m2aej_43">Lorsque vous cr&eacute;ez un projet Spring Boot avec l'Initializr, si vous n'avez rien d&eacute;coch&eacute;, vous avez d&eacute;j&agrave; tout ce qu'il faut. Le secret est dans cette d&eacute;pendance de votre <code class="code" id="-7m2aej_49">pom.xml</code>:</p><div class="code-block" data-lang="markup">

&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
</div><p id="-7m2aej_45">Ce &quot;starter&quot; n'est pas une biblioth&egrave;que unique, mais un m&eacute;ta-package qui regroupe un ensemble de d&eacute;pendances de test soigneusement s&eacute;lectionn&eacute;es et compatibles entre elles.</p><section class="procedure-steps"><h3 id="-7m2aej_46" data-toc="-7m2aej_46">Que contient le spring-boot-starter-test ?</h3><ol class="list _decimal"><li class="list__item" id="-7m2aej_50"><p><b id="-7m2aej_56">Spring Test &amp; Spring Boot Test :</b> Le c&oelig;ur du r&eacute;acteur. C'est le module qui fournit les annotations comme <code class="code" id="-7m2aej_57">@SpringBootTest</code>, <code class="code" id="-7m2aej_58">@MockBean</code>, et qui sait comment d&eacute;marrer et configurer votre application pour un test.</p></li><li class="list__item" id="-7m2aej_51"><p><b id="-7m2aej_59">JUnit 5 :</b> Votre ex&eacute;cuteur de tests, que vous connaissez d&eacute;j&agrave;.</p></li><li class="list__item" id="-7m2aej_52"><p><b id="-7m2aej_60">Mockito :</b> Votre usine &agrave; mocks, que vous ma&icirc;trisez &eacute;galement.</p></li><li class="list__item" id="-7m2aej_53"><p><b id="-7m2aej_61">AssertJ :</b> Votre biblioth&egrave;que d'assertions fluides, votre outil de pr&eacute;dilection.</p></li><li class="list__item" id="-7m2aej_54"><p><b id="-7m2aej_62">Hamcrest :</b> Une autre biblioth&egrave;que d'assertions (souvent utilis&eacute;e par Mockito en interne).</p></li><li class="list__item" id="-7m2aej_55"><p><b id="-7m2aej_63">JsonPath :</b> Un outil pour naviguer et faire des assertions sur des documents JSON, tr&egrave;s utile pour tester des API REST.</p></li></ol></section><p id="-7m2aej_47">Le <code class="code" id="-7m2aej_64">&lt;scope&gt;test&lt;/scope&gt;</code> est crucial : il indique &agrave; Maven que ces d&eacute;pendances ne sont n&eacute;cessaires que pour compiler et ex&eacute;cuter les tests. Elles ne seront pas incluses dans le package final de votre application (le JAR ou le WAR), ce qui n'alourdit pas votre production.</p></section><section class="chapter"><h2 id="springboottest-le-test-grandeur-nature" data-toc="springboottest-le-test-grandeur-nature"><code class="code" id="-7m2aej_71">@SpringBootTest</code>: Le Test Grandeur Nature</h2><p id="-7m2aej_66">C'est l'annotation la plus importante et la plus simple pour commencer. Quand vous l'ajoutez sur votre classe de test, vous demandez &agrave; Spring de faire quelque chose de magique :</p><p id="-7m2aej_67"><span class="control" id="-7m2aej_72">&quot;D&eacute;marre une version compl&egrave;te de mon application en arri&egrave;re-plan, avec son contexte, son injection de d&eacute;pendances, et tout ce qui la compose.&quot;</span></p><p id="-7m2aej_68">C'est comme lancer votre application, mais dans un environnement contr&ocirc;l&eacute; pour les tests.</p><div class="code-block" data-lang="java">
// Fichier : src/test/java/fr/formation/spring/ApplicationTests.java
package fr.formation.spring;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

// Cette annotation suffit pour démarrer tout le contexte Spring.
@SpringBootTest
class ApplicationTests {

    @Test
    void contextLoads() {
        // Ce test est souvent généré par défaut.
        // Son seul but est de vérifier que l'application
        // démarre correctement sans lancer d'exception.
        // S'il passe, votre configuration est saine !
    }

}
</div><aside class="prompt" data-type="tip" data-title="" id="-7m2aej_70"><p>L'annotation `@ExtendWith(SpringExtension.class)` est ce qui relie JUnit 5 au framework de test de Spring. Cependant, avec `@SpringBootTest` et les autres annotations de test Spring, **cette extension est incluse automatiquement**. Vous n'avez donc pas besoin de l'ajouter vous-m&ecirc;me.</p></aside></section><section class="chapter"><h2 id="l-injection-de-d-pendances-au-service-des-tests" data-toc="l-injection-de-d-pendances-au-service-des-tests">L'Injection de D&eacute;pendances au Service des Tests</h2><p id="-7m2aej_73">Puisque <code class="code" id="-7m2aej_82">@SpringBootTest</code> charge le contexte de votre application, vous pouvez y acc&eacute;der directement ! Vous pouvez demander &agrave; Spring de vous injecter n'importe quel bean (<code class="code" id="-7m2aej_83">@Service</code>, <code class="code" id="-7m2aej_84">@Component</code>, <code class="code" id="-7m2aej_85">@Repository</code>, etc.) directement dans votre classe de test avec <code class="code" id="-7m2aej_86">@Autowired</code>.</p><p id="-7m2aej_74">Mais le plus puissant, c'est de pouvoir remplacer un bean par un mock. C'est le r&ocirc;le de <code class="code" id="-7m2aej_87">@MockBean</code>.</p><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="294px" preserveAspectRatio="none" style="width:559px;height:294px;background:#FFFFFF;" version="1.1" viewBox="0 0 559 294" width="559px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="155" x="195.25" y="23.5352">@MockBean en action</text><!--cluster Contexte Spring de Test--><g id="cluster_Contexte Spring de Test"><path d="M9.5,189.9783 L182.5,189.9783 A5.25,5.25 0 0 1 186,193.4783 L193,212.4666 L313.5,212.4666 A3.5,3.5 0 0 1 317,215.9666 L317,283.9683 A3.5,3.5 0 0 1 313.5,287.4683 L9.5,287.4683 A3.5,3.5 0 0 1 6,283.9683 L6,193.4783 A3.5,3.5 0 0 1 9.5,189.9783 " fill="none" style="stroke:#696969;stroke-width:1.0;"/><line style="stroke:#696969;stroke-width:1.0;" x1="6" x2="193" y1="212.4666" y2="212.4666"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="174" x="10" y="205.5134">Contexte Spring de Test</text></g><!--cluster Classe de Test--><g id="cluster_Classe de Test"><path d="M72.5,43.4883 L177.5,43.4883 A5.25,5.25 0 0 1 181,46.9883 L188,65.9766 L245.5,65.9766 A3.5,3.5 0 0 1 249,69.4766 L249,137.4783 A3.5,3.5 0 0 1 245.5,140.9783 L72.5,140.9783 A3.5,3.5 0 0 1 69,137.4783 L69,46.9883 A3.5,3.5 0 0 1 72.5,43.4883 " fill="none" style="stroke:#696969;stroke-width:1.0;"/><line style="stroke:#696969;stroke-width:1.0;" x1="69" x2="188" y1="65.9766" y2="65.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="106" x="73" y="59.0234">Classe de Test</text></g><!--entity UserService--><g id="elem_UserService"><rect fill="#F1F1F1" height="46.4883" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="119" x="181.5" y="224.9783"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="280.5" y="229.9783"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="278.5" y="231.9783"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="278.5" y="235.9783"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="196.5" y="258.5134">UserService</text></g><!--entity EmailService--><g id="elem_EmailService"><rect fill="#F1F1F1" height="46.4883" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="125" x="21.5" y="224.9783"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="126.5" y="229.9783"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="124.5" y="231.9783"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="124.5" y="235.9783"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="36.5" y="258.5134">EmailService</text></g><!--entity UserServiceTest--><g id="elem_UserServiceTest"><rect fill="#F1F1F1" height="46.4883" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="148" x="85" y="78.4883"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="213" y="83.4883"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="211" y="85.4883"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="211" y="89.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="100" y="112.0234">UserServiceTest</text></g><g id="elem_GMN9"><path d="M335.5,223.7583 L335.5,272.6899 A3.5,3.5 0 0 0 339,276.1899 L549,276.1899 A3.5,3.5 0 0 0 552.5,272.6899 L552.5,230.2583 L542.5,220.2583 L339,220.2583 A3.5,3.5 0 0 0 335.5,223.7583 " fill="#7FFFD4" style="stroke:#454645;stroke-width:1.5;"/><path d="M542.5,220.2583 L542.5,228.5083 A1.75,1.75 0 0 0 544.25,230.2583 L552.5,230.2583 L542.5,220.2583 " fill="#7FFFD4" style="stroke:#454645;stroke-width:1.0;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="341.5" y="237.8266">Le vrai bean `EmailService` est</text><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="341.5" y="253.1372">remplac&#233; par un mock Mockito</text><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="341.5" y="268.4477">dans le contexte pour ce test.</text></g><!--link UserServiceTest to UserService--><g id="link_UserServiceTest_UserService"><path d="M171.81,125.3083 C187.22,152.4583 209.9483,192.5102 225.3183,219.5902 " fill="none" id="UserServiceTest-to-UserService" style="stroke:#454645;stroke-width:1.0;"/><polygon fill="#454645" points="228.28,224.8083,227.3162,215.0067,225.8119,220.4599,220.3588,218.9556,228.28,224.8083" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="198.54" y="170.5466">@Autowired</text></g><!--link UserServiceTest to EmailService--><g id="link_UserServiceTest_EmailService"><path d="M127.73,125.4183 C117.74,134.1983 107.57,145.0183 101,156.9783 C89.41,178.0783 85.9433,199.6999 84.7533,218.7899 " fill="none" id="UserServiceTest-to-EmailService" style="stroke:#454645;stroke-width:1.0;"/><polygon fill="#454645" points="84.38,224.7783,88.9322,216.0446,84.6911,219.788,80.9477,215.5469,84.38,224.7783" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="102" y="170.5466">@MockBean</text></g><!--link EmailService to GMN9--><g id="link_EmailService_GMN9"><path d="M103.16,224.5083 C121.01,204.4583 149.61,177.1883 181.5,165.4783 C230.73,147.4083 248.82,151.9983 299.5,165.4783 C339.17,176.0383 379.29,200.3383 407.16,219.8883 " fill="none" id="EmailService-GMN9" style="stroke:#454645;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--SRC=[TL0nJWD13Ept5SFruG4KA83ee0fKA5ASFNEnSkSzUNq94k91l8EFiOiKb81IUiOp7i-5RtXWx6Hjf1vSl6SqyySKjxTC2bPGT4dQX31It59NwBkapc_EM8mcsg5bF77s1ky1U7dER0ksdKHUrlb-8Eb_WOzZdvvovlFoYlue_e6OpQvFB-4Ayvl9qrwCstE2aoXLSVWp14tb7vDkuqYlVqC33wKZ8y6wbh8wPbSe_cN3U1XxYb-V6CamAORYZNf0F1M-9SqevSP3UMEQ397XHNyPM5lK3Dy0]--></g></svg></div><p id="-7m2aej_76">Imaginons un <code class="code" id="-7m2aej_88">GreeterService</code> qui d&eacute;pend d'un <code class="code" id="-7m2aej_89">TimeService</code> pour adapter son message.</p><div class="code-block" data-lang="java">
// fr.formation.spring.service.TimeService.java
package fr.formation.spring.service;

import org.springframework.stereotype.Service;

import java.time.LocalTime;

@Service
public class TimeService {
    public boolean isMorning() {
        return LocalTime.now().getHour() &lt; 12;
    }
}
</div><div class="code-block" data-lang="java">
// fr.formation.spring.service.GreeterService.java
package fr.formation.spring.service;

import org.springframework.stereotype.Service;

@Service
public class GreeterService {
    private final TimeService timeService;

    public GreeterService(TimeService timeService) {
        this.timeService = timeService;
    }

    public String greet() {
        if (timeService.isMorning()) {
            return &quot;Bonjour !&quot;;
        }
        return &quot;Bonsoir !&quot;;
    }
}
</div><p id="-7m2aej_79">Comment tester le cas du &quot;Bonsoir&quot; sans attendre l'apr&egrave;s-midi ? On utilise <code class="code" id="-7m2aej_90">@MockBean</code>!</p><div class="code-block" data-lang="java">
// src/test/java/fr/formation/spring/service/GreeterServiceTest.java
package fr.formation.spring.service;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.mock.mockito.MockBean;

import static org.assertj.core.api.Assertions.assertThat;
import static org.mockito.Mockito.when;

@SpringBootTest
class GreeterServiceTest {

    @Autowired // Injecte le VRAI bean GreeterService depuis le contexte
    private GreeterService greeterService;

    @MockBean // REMPLACE le bean TimeService dans le contexte par un MOCK
    private TimeService mockTimeService;

    @Test
    void greetShouldSayBonsoir_whenItIsEvening() {
        // Arrange : On configure le mock
        when(mockTimeService.isMorning()).thenReturn(false);

        // Act
        String greeting = greeterService.greet();

        // Assert
        assertThat(greeting).isEqualTo(&quot;Bonsoir !&quot;);
    }
}
</div><aside class="prompt" data-type="warning" data-title="" id="-7m2aej_81"><p>**`@MockBean` vs. `@Mock`** Ne confondez pas `@MockBean` (de Spring) et `@Mock` (de Mockito). - `@Mock` cr&eacute;e un mock simple, que vous devez injecter manuellement. - `@MockBean` cr&eacute;e un mock et l'ins&egrave;re directement dans le contexte d'application Spring, en rempla&ccedil;ant le vrai bean s'il existe. C'est beaucoup plus puissant dans un test d'int&eacute;gration.</p></aside></section><section class="chapter"><h2 id="configurer-votre-environnement-de-test" data-toc="configurer-votre-environnement-de-test">Configurer Votre Environnement de Test</h2><p id="-7m2aej_91">Vous ne voulez certainement pas que vos tests tournent sur votre base de donn&eacute;es de production ou de d&eacute;veloppement. Spring offre plusieurs moyens d'adapter la configuration pour les tests.</p><div class="tabs" id="-7m2aej_92" data-anchors="[-7m2aej_93,-7m2aej_94,-7m2aej_95]"><div class="tabs__content" data-gtm="tab" id="-7m2aej_93" data-title="application-test.properties"><p id="-7m2aej_96">Le moyen le plus simple. Si vous cr&eacute;ez un fichier <code class="code" id="-7m2aej_99">src/test/resources/application-test.properties</code> (ou <code class="code" id="-7m2aej_100">.yml</code>), Spring Boot le chargera automatiquement pour les tests.</p><p id="-7m2aej_97">C'est l'endroit id&eacute;al pour configurer une base de donn&eacute;es en m&eacute;moire comme H2.</p><div class="code-block" data-lang="properties" data-title="Properties">
    # Configuration pour la base de données de test
    spring.datasource.url=jdbc:h2:mem:testdb
    spring.datasource.driverClassName=org.h2.Driver
    spring.datasource.username=sa
    spring.datasource.password=password

    # Force la création du schéma à chaque fois
    spring.jpa.hibernate.ddl-auto=create-drop
</div></div><div class="tabs__content" data-gtm="tab" id="-7m2aej_94" data-title="@ActiveProfiles"><p id="-7m2aej_101">Les profils Spring sont un moyen puissant de s&eacute;parer les configurations. Vous pouvez activer un profil sp&eacute;cifique pour vos tests avec l'annotation <code class="code" id="-7m2aej_105">@ActiveProfiles</code>.</p><p id="-7m2aej_102">Par exemple, si votre fichier <code class="code" id="-7m2aej_106">application-test.properties</code> existe, le profil &quot;test&quot; est souvent activ&eacute; implicitement. Mais vous pouvez &ecirc;tre explicite :</p><p> <code class="code" id="-7m2aej_103">@SpringBootTest @ActiveProfiles(&quot;test&quot;) class MyServiceTest { // ... }</code></p><p id="-7m2aej_104">Cela permet de cr&eacute;er des fichiers de configuration sp&eacute;cifiques comme <code class="code" id="-7m2aej_107">application-test.properties</code>, <code class="code" id="-7m2aej_108">application-dev.properties</code>, etc.</p></div><div class="tabs__content" data-gtm="tab" id="-7m2aej_95" data-title="@TestConfiguration"><p id="-7m2aej_109">Parfois, vous voulez d&eacute;finir un bean sp&eacute;cifique <em id="-7m2aej_112">uniquement</em> pour un test ou une classe de test. C'est le r&ocirc;le de <code class="code" id="-7m2aej_113">@TestConfiguration</code>.</p><p id="-7m2aej_110">Un bean d&eacute;fini ici ne remplacera pas un bean existant, mais sera ajout&eacute; au contexte. C'est parfait pour fournir des beans utilitaires pour les tests.</p><div class="code-block" data-lang="java" data-title="Java">
    @SpringBootTest
    class MyTimeSensitiveTest {

        @TestConfiguration
        static class TestConfig {
            // On fournit un bean Clock fixe pour nos tests
            // afin de maîtriser le temps.
            @Bean
            public Clock testClock() {
                return Clock.fixed(
                    Instant.parse(&quot;2023-10-27T10:00:00Z&quot;),
                    ZoneId.of(&quot;UTC&quot;)
                );
            }
        }
        
        @Autowired
        private Clock clock; // Sera injecté depuis notre TestConfig
        
        // ... tests qui utilisent ce &quot;clock&quot; prévisible ...
    }
</div></div></div></section><section class="chapter"><h2 id="exercice-5-votre-premier-test-d-int-gration-avec-spring-boot" data-toc="exercice-5-votre-premier-test-d-int-gration-avec-spring-boot">Exercice 5 : Votre premier test d'int&eacute;gration avec Spring Boot</h2><p id="-7m2aej_114">Imaginons un service qui recherche des livres dans notre catalogue. Il doit retourner une mention sp&eacute;ciale si le livre est un &quot;best-seller&quot;.</p><p id="-7m2aej_115">Voici le code de base (que vous placeriez dans <code class="code" id="-7m2aej_120">src/main/java</code>) :</p><div class="code-block" data-lang="java">
// fr.formation.spring.entity.Book.java
public class Book {
    private String title;
    private String author;
    private boolean isBestSeller;
    // ... constructeurs, getters
}
</div><div class="code-block" data-lang="java">
// fr.formation.spring.repository.BookRepository.java
import java.util.Optional;

@Repository
public interface BookRepository extends JpaRepository&lt;Book, Long&gt; {
    Optional&lt;Book&gt; findByTitle(String title);
}

// fr.formation.spring.service.BookService.java
@Service
public class BookService {
    private final BookRepository bookRepository;

    public BookService(BookRepository bookRepository) {
        this.bookRepository = bookRepository;
    }

    public String getBookDescription(String title) {
        Optional&lt;Book&gt; bookOpt = bookRepository.findByTitle(title);
        if (bookOpt.isEmpty()) {
            return &quot;Livre non trouvé.&quot;;
        }
        Book book = bookOpt.get();
        String description = book.getTitle() + &quot; par &quot; + book.getAuthor();
        if (book.isBestSeller()) {
            description += &quot; [BEST-SELLER]&quot;;
        }
        return description;
    }
}
</div><p id="-7m2aej_118"><span class="control" id="-7m2aej_121">Votre mission :</span> &Eacute;crivez une classe de test <code class="code" id="-7m2aej_122">BookServiceTest</code> qui teste la m&eacute;thode <code class="code" id="-7m2aej_123">getBookDescription</code> pour un livre qui est un best-seller.</p><ol class="list _decimal" id="-7m2aej_119" type="1"><li class="list__item" id="-7m2aej_124"><p id="-7m2aej_129">Utilisez <code class="code" id="-7m2aej_130">@SpringBootTest</code> pour charger le contexte.</p></li><li class="list__item" id="-7m2aej_125"><p id="-7m2aej_131">Injectez le <code class="code" id="-7m2aej_132">BookService</code> avec <code class="code" id="-7m2aej_133">@Autowired</code>.</p></li><li class="list__item" id="-7m2aej_126"><p id="-7m2aej_134">Remplacez le <code class="code" id="-7m2aej_135">BookRepository</code> par un mock avec <code class="code" id="-7m2aej_136">@MockBean</code>.</p></li><li class="list__item" id="-7m2aej_127"><p id="-7m2aej_137">Dans votre m&eacute;thode de test, configurez le mock pour qu'il retourne un <code class="code" id="-7m2aej_138">Optional</code> contenant un livre &quot;best-seller&quot; lorsque la m&eacute;thode <code class="code" id="-7m2aej_139">findByTitle</code> est appel&eacute;e.</p></li><li class="list__item" id="-7m2aej_128"><p id="-7m2aej_140">Appelez la m&eacute;thode du service et utilisez AssertJ pour v&eacute;rifier que la description retourn&eacute;e contient bien la mention <code class="code" id="-7m2aej_141">[BEST-SELLER]</code>.</p></li></ol></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h2 id="correction-exercice-5" data-toc="correction-exercice-5">Correction exercice 5</h2></div><div class="collapse__content"><div class="code-block" data-lang="java">
// Fichier : src/test/java/fr/formation/spring/service/BookServiceTest.java
package fr.formation.spring.service;

import fr.formation.spring.entity.Book;
import fr.formation.spring.repository.BookRepository;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.mock.mockito.MockBean;

import java.util.Optional;

import static org.assertj.core.api.Assertions.assertThat;
import static org.mockito.Mockito.when;

@SpringBootTest
class BookServiceTest {

    @Autowired
    private BookService bookService;

    @MockBean
    private BookRepository mockBookRepository;

    @Test
    @DisplayName(&quot;Devrait retourner une description avec [BEST-SELLER] pour un best-seller&quot;)
    void getBookDescription_shouldIncludeBestSellerTag_forBestSellerBook() {
        // Arrange
        // 1. Créez les données de test
        String searchTitle = &quot;L'Art du Test&quot;;
        Book testBook = new Book(searchTitle, &quot;Formateur Pro&quot;, true);

        // 2. Configurez le comportement du mock
        // QUAND findByTitle est appelé avec &quot;L'Art du Test&quot;,
        // ALORS retourne un Optional contenant notre livre de test.
        when(mockBookRepository.findByTitle(searchTitle))
                .thenReturn(Optional.of(testBook));

        // Act
        // 3. Appelez la méthode à tester
        String description = bookService.getBookDescription(searchTitle);

        // Assert
        // 4. Vérifiez le résultat avec AssertJ
        assertThat(description)
                .isNotNull()
                .startsWith(&quot;L'Art du Test par Formateur Pro&quot;)
                .endsWith(&quot;[BEST-SELLER]&quot;)
                .contains(&quot;L'Art du Test par Formateur Pro [BEST-SELLER]&quot;);
    }
}
</div></div></div></section><section class="chapter"><h2 id="auto-valuation" data-toc="auto-valuation">Auto-&eacute;valuation</h2><ol class="list _decimal" id="-7m2aej_143" type="1"><li class="list__item" id="-7m2aej_145"><p id="-7m2aej_150">(Question ouverte) Quelle est la diff&eacute;rence fondamentale entre <code class="code" id="-7m2aej_151">@Mock</code> (de Mockito) et <code class="code" id="-7m2aej_152">@MockBean</code> (de Spring Boot) ?</p></li><li class="list__item" id="-7m2aej_146"><p id="-7m2aej_153">(QCM) Le starter <code class="code" id="-7m2aej_155">spring-boot-starter-test</code> inclut-il par d&eacute;faut...</p><ul class="list _bullet" id="-7m2aej_154"><li class="list__item" id="-7m2aej_156"><p id="-7m2aej_160">a) Uniquement JUnit 5.</p></li><li class="list__item" id="-7m2aej_157"><p id="-7m2aej_161">b) Uniquement Spring Test et Mockito.</p></li><li class="list__item" id="-7m2aej_158"><p id="-7m2aej_162">c) Un ensemble de biblioth&egrave;ques incluant Spring Test, JUnit 5, Mockito et AssertJ.</p></li><li class="list__item" id="-7m2aej_159"><p id="-7m2aej_163">d) Uniquement des outils pour tester des API REST.</p></li></ul></li><li class="list__item" id="-7m2aej_147"><p id="-7m2aej_164">(Question ouverte) Vous souhaitez utiliser une base de donn&eacute;es H2 en m&eacute;moire pour vos tests, mais votre <code class="code" id="-7m2aej_165">application.properties</code> principal pointe vers une base PostgreSQL. Quelle est la mani&egrave;re la plus simple d'y parvenir ?</p></li><li class="list__item" id="-7m2aej_148"><p id="-7m2aej_166">(QCM) L'annotation <code class="code" id="-7m2aej_168">@SpringBootTest</code>...</p><ul class="list _bullet" id="-7m2aej_167"><li class="list__item" id="-7m2aej_169"><p id="-7m2aej_173">a) Ne teste que la couche web de l'application.</p></li><li class="list__item" id="-7m2aej_170"><p id="-7m2aej_174">b) Charge un contexte d'application Spring complet, rendant les beans disponibles pour l'injection.</p></li><li class="list__item" id="-7m2aej_171"><p id="-7m2aej_175">c) Doit toujours &ecirc;tre utilis&eacute;e avec <code class="code" id="-7m2aej_176">@ExtendWith(SpringExtension.class)</code>.</p></li><li class="list__item" id="-7m2aej_172"><p id="-7m2aej_177">d) Est une alternative &agrave; l'utilisation de <code class="code" id="-7m2aej_178">pom.xml</code>.</p></li></ul></li><li class="list__item" id="-7m2aej_149"><p id="-7m2aej_179">(QCM) Que fait une classe de configuration annot&eacute;e avec <code class="code" id="-7m2aej_181">@TestConfiguration</code>?</p><ul class="list _bullet" id="-7m2aej_180"><li class="list__item" id="-7m2aej_182"><p id="-7m2aej_186">a) Elle remplace la configuration principale de l'application.</p></li><li class="list__item" id="-7m2aej_183"><p id="-7m2aej_187">b) Elle ajoute des beans au contexte de test, qui peuvent &ecirc;tre utilis&eacute;s en plus des beans de l'application principale.</p></li><li class="list__item" id="-7m2aej_184"><p id="-7m2aej_188">c) Elle d&eacute;sactive tous les beans de l'application principale.</p></li><li class="list__item" id="-7m2aej_185"><p id="-7m2aej_189">d) Elle ne fonctionne qu'avec le profil &quot;test&quot;.</p></li></ul></li></ol><p id="-7m2aej_144"><span class="emphasis" id="-7m2aej_190">(Les corrections de l'auto-&eacute;valuation seront fournies &agrave; la toute fin du support de cours.)</span></p></section><section class="chapter"><h2 id="conclusion-de-la-partie" data-toc="conclusion-de-la-partie">Conclusion de la partie</h2><p id="-7m2aej_191">Vous avez franchi une &eacute;tape d&eacute;cisive ! Vous savez maintenant comment le framework Spring Boot agit comme un formidable acc&eacute;l&eacute;rateur pour vos tests. Vous avez appris &agrave; lancer votre application dans un environnement de test avec <code class="code" id="-7m2aej_193">@SpringBootTest</code>, &agrave; injecter des composants r&eacute;els avec <code class="code" id="-7m2aej_194">@Autowired</code> et, surtout, &agrave; les remplacer par des doublures avec <code class="code" id="-7m2aej_195">@MockBean</code> pour un contr&ocirc;le total. Vous ma&icirc;trisez &eacute;galement les bases de la configuration de test.</p><p id="-7m2aej_192">Cependant, <code class="code" id="-7m2aej_196">@SpringBootTest</code> charge <span class="emphasis" id="-7m2aej_197">toute</span> l'application. C'est puissant, mais cela peut &ecirc;tre lent. Dans les prochains chapitres, nous allons apprendre &agrave; tester notre application par &quot;tranches&quot; (slices). Nous verrons comment tester uniquement la couche web (<code class="code" id="-7m2aej_198">@WebMvcTest</code>) ou uniquement la couche de donn&eacute;es (<code class="code" id="-7m2aej_199">@DataJpaTest</code>) de mani&egrave;re beaucoup plus rapide et cibl&eacute;e. Vous allez devenir un chirurgien du test</p></section><div class="last-modified">27 juillet 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="002-01-mastering-the-tools.html" class="navigation-links__prev">Chapitre 2 : Ma&icirc;triser Votre Bo&icirc;te &agrave; Outils de Test (Pour aller plus loin)</a><a href="003-01-advanced-conf.html" class="navigation-links__next">Chapitre 3 : Configurations Avanc&eacute;es et Contr&ocirc;le de l'Environnement de Test (Pour aller plus loin)</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>